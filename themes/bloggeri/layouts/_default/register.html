{{ define "main" }}
<section class="section">
  <article>      
    <div class="container">
      <div class="post">
        <h1 data-pagefind-ignore class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
  <div class="content">
        <div class="columns is-multiline">
<h2>Registration Form</h2>
<form id="registrationForm">
  <label for="registrationEmail">Email:</label>
  <input type="email" id="registrationEmail" name="email" required><br><br>
  <label for="registrationPassword">Password:</label>
  <input type="password" id="registrationPassword" name="password" required><br><br>
  <button type="submit">Register</button>
</form>

<form id="loginForm">
  <label for="loginEmail">Email:</label>
  <input type="email" id="loginEmail" name="email" required>
  <br>
  <label for="loginPassword">Password:</label>
  <input type="password" id="loginPassword" name="password" required>
  <br>
  <button type="submit">Login</button>
</form>

            <button id="cloudsave">Save to Firebase Storage</button>
          <button id="loadcloudsave">Load Cloud Save</button>

<button id="logout">Logout</button>

            <button id="deleteAccount">Delete Account</button>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
<script>
  var firebaseConfig = {
    apiKey: "AIzaSyCP3lyYIs5GjA6XYS9aSdaz5X6-ru3Fxeo",
    authDomain: "gamedb-95862.firebaseapp.com",
    databaseURL: "https://gamedb-95862-default-rtdb.firebaseio.com",
    projectId: "gamedb-95862",
    storageBucket: "gamedb-95862.appspot.com",
    messagingSenderId: "788250168154",
    appId: "1:788250168154:web:b6573c45a909fc09694163"
  };
  firebase.initializeApp(firebaseConfig);

  // Get the registration form element
  const registrationForm = document.getElementById('registrationForm');

  // Add an event listener to the registration form
  registrationForm.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevent the form from submitting

    // Get user input values
    const email = registrationForm.email.value;
    const password = registrationForm.password.value;

    // Create a new user with email and password
    firebase.auth().createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        // Registration successful
        const user = userCredential.user;
        console.log('Registration successful:', user);
        // You can redirect the user to a different page or perform additional actions here
      })
      .catch((error) => {
        // Registration failed
        const errorCode = error.code;
        const errorMessage = error.message;
        console.error('Registration failed:', errorCode, errorMessage);
        // Display an error message to the user or handle the error appropriately
      });
  });

  // login

   const loginForm = document.getElementById('loginForm');

    // Add an event listener to the login form
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault(); // Prevent the form from submitting

      // Get user input values
      const email = loginForm.email.value;
      const password = loginForm.password.value;

      // Sign in the user with email and password
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // Login successful
          const user = userCredential.user;
          console.log('Login successful:', user);
          // You can redirect the user to a different page or perform additional actions here
        })
        .catch((error) => {
          // Login failed
          const errorCode = error.code;
          const errorMessage = error.message;
          console.error('Login failed:', errorCode, errorMessage);
          // Display an error message to the user or handle the error appropriately
        });
    });

// log out

  // Get the logout button element
const logoutButton = document.getElementById('logout');

// Add an event listener to the logout button
logoutButton.addEventListener('click', () => {
  // Sign out the user
  firebase.auth().signOut()
    .then(() => {
      // Logout successful
      console.log('Logout successful');
      // You can redirect the user to a different page or perform additional actions here
    })
    .catch((error) => {
      // Logout failed
      console.error('Logout failed:', error);
      // Display an error message to the user or handle the error appropriately
    });
});

  // delete

  // Get the delete account button element
const deleteAccountButton = document.getElementById('deleteAccount');

// Add an event listener to the delete account button
deleteAccountButton.addEventListener('click', () => {
  // Get the currently logged-in user
  const user = firebase.auth().currentUser;

  // Prompt the user for re-authentication (e.g., password confirmation) before deleting the account
  const password = prompt('Please enter your password to confirm account deletion:');

  // Create a credential with the user's email and password
  const credential = firebase.auth.EmailAuthProvider.credential(user.email, password);

  // Re-authenticate the user with the provided credential
  user.reauthenticateWithCredential(credential)
    .then(() => {
      // User re-authenticated successfully, proceed with account deletion
      user.delete()
        .then(() => {
          // Account deletion successful
          console.log('Account deletion successful');
          // You can redirect the user to a different page or perform additional actions here
        })
        .catch((error) => {
          // Account deletion failed
          console.error('Account deletion failed:', error);
          // Display an error message to the user or handle the error appropriately
        });
    })
    .catch((error) => {
      // Re-authentication failed
      console.error('Re-authentication failed:', error);
      // Display an error message to the user or handle the error appropriately
    });
});
  
  // cloud save

 const cloudSaveButton = document.getElementById('cloudsave');

// Add an event listener to the cloudsave button
cloudSaveButton.addEventListener('click', () => {
// Get the current user
const user = firebase.auth().currentUser;

if (user) {
  // Generate a unique file name using the user's UID
  const fileName = user.uid + '.json';

  // Convert localStorage data to JSON
  const localStorageData = JSON.stringify(localStorage);

  // Compress the localStorageData using LZString
  const compressedData = LZString.compressToEncodedURIComponent(localStorageData);

  // Create a reference to the Firebase Storage folder
  const storageRef = firebase.storage().ref();

  // Create a child reference with the file path and upload the data
  const fileRef = storageRef.child('data/' + user.uid + '/' + fileName);
  fileRef.putString(compressedData, 'raw')
    .then(() => {
      console.log('Data saved to Firebase Storage successfully.');
    })
    .catch((error) => {
      console.error('Data upload to Firebase Storage failed:', error);
    });
} else {
  console.error('User not logged in.');
}
});
  
  // cloud load 

 document.getElementById('loadcloudsave').addEventListener('click', function() {
  const user = firebase.auth().currentUser;

  if (user) {
    // Generate the file name based on the user's UID
    const fileName = user.uid + '.json';

    // Create a reference to the Firebase Storage file
    const storageRef = firebase.storage().ref();
    const fileRef = storageRef.child('data/' + user.uid + '/' + fileName);

    // Get the download URL for the file
fileRef.getDownloadURL()
  .then((downloadURL) => {
    // Use the download URL to retrieve the file data
    fetch(downloadURL)
      .then((response) => response.text())
      .then((compressedData) => {
        // Decompress the compressed data using LZString
        const localStorageData = LZString.decompressFromEncodedURIComponent(compressedData);

        // Parse the decompressed data as JSON
        const data = JSON.parse(localStorageData);
        console.log('Retrieved data:', data);

        // Store each key-value pair in localStorage
        for (let key in data) {
          localStorage.setItem(key, data[key]);
        }

        // Do something with the retrieved data if needed
      })
      .catch((error) => {
        console.error('Error retrieving data:', error);
      });
  })
  .catch((error) => {
    console.error('Error getting download URL:', error);
  });
  } else {
    console.error('User not logged in.');
  }
});

  // auth console
  
  firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    // User is logged in
    console.log('User logged in:', user);
  } else {
    // User is logged out
    console.log('User logged out.');
  }
});
</script>
          
          
     </div>
    </div>     </div>   </div>  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
  </article>    
</section>
{{ end }}
