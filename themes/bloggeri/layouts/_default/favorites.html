{{ define "main" }}
<section class="section">
  <article>      
    <div class="container">
      <div class="post">
        <h1 data-pagefind-ignore class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
  <div class="content">
    <span>Favorites: <p id="totalCount-fav"></p></span>
      <button id="sendDataButton">Send Data to GitHub</button>
    <div id="cardContainer"></div>   
     </div>
    </div>     </div>  
  </article>    
</section>
  <script>
    document.getElementById('sendDataButton').addEventListener('click', sendDataToGitHub);

    function sendDataToGitHub() {
      const localStorageData = JSON.stringify(localStorage); // Assuming local storage data is already in JSON format

      // GitHub repository information
      const owner = 'YuushaExa';
      const repo = 'web';
      const branch = 'master';
      const directory = 'dev/json/favfiles';
      const filename = 'data.json';
      
const token = "{{ .Site.Params.fav.key }}";      
      const apiUrl = "https://api.github.com/repos/YuushaExa/web/contents/dev/json/favfiles/data.json";
      // Create the file content object
      const encoder = new TextEncoder();
      const dataEncoded = encoder.encode(localStorageData);
      const base64Data = base64ArrayBuffer(dataEncoded);

      const fileContent = {
        message: 'Update data.json from local storage',
        content: base64Data,
      };

      // Make the API request to create or update the file
      fetch(apiUrl, {
        method: 'PUT',
        headers: {
          Authorization: "Bearer ${token}",
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(fileContent),
      })
        .then(response => response.json())
        .then(data => {
          console.log('File created or updated successfully:', data);
        })
        .catch(error => {
          console.error('Error creating or updating the file:', error);
        });
    }

    // Function to convert the ArrayBuffer to a base64 string
    function base64ArrayBuffer(arrayBuffer) {
      let binary = '';
      const bytes = new Uint8Array(arrayBuffer);
      const len = bytes.byteLength;
      for (let i = 0; i < len; i++) {
        binary += String.fromCharCode(bytes[i]);
      }
      return btoa(binary);
    }
  </script>
<script>
window.onload = function() {
  displaySavedCards();
  attachToggleListeners();

var toggleButtons = document.querySelectorAll('.toggleButton path');
toggleButtons.forEach(function(button) {
  button.style.fill = 'unset';
});
var toggleButtons1 = document.querySelectorAll('.toggleButtonSVG');
toggleButtons1.forEach(function(button1) {
  button1.style.fill = 'rgb(4 252 14 / 80%)';
});
};
</script>
{{ end }}
