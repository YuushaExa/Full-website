{{ define "main" }}
<section class="section">
  <article>      
    <div class="container">
      <div class="post">
        <h1 data-pagefind-ignore class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
  <div class="content">
    <span>Favorites: <p id="totalCount-fav"></p></span>
      <button id="sendDataButton">Send Data to GitHub</button>
    <button id="getDataButton">Get Data</button>
    <div id="cardContainer"></div>   
     </div>
    </div>     </div>  
  </article>    
</section>
<script src="https://fav2.pages.dev/new2.js"></script>
<script>
document.getElementById('getDataButton').addEventListener('click', getDataFromGitHub);

function getDataFromGitHub() {
  // GitHub repository information
  const owner = 'YuushaExa';
  const repo = 'web';
  const branch = 'master';
  const directory = 'dev/json/favfiles';
  const filename = 'data.json';

  const apiUrl = "https://api.github.com/repos/${owner}/${repo}/contents/${directory}/${filename}";

  fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
      const content = data.content;
      let decodedData;

      try {
        decodedData = decodeBase64Content(content);
      } catch (error) {
        console.error('Error decoding base64 content:', error);
        return;
      }

      let jsonData;
      try {
        jsonData = JSON.parse(decodedData);
      } catch (error) {
        console.error('Error parsing JSON data:', error);
        return;
      }

      // Store the game titles and their content in local storage
      for (const title in jsonData) {
        if (jsonData.hasOwnProperty(title) && title !== 'folders') {
          localStorage.setItem(title, jsonData[title]);
        }
      }
      console.log('Data retrieved and stored in local storage:', jsonData);
    })
    .catch(error => {
      console.error('Error retrieving data:', error);
    });
}

function decodeBase64Content(content) {
  const padding = '='.repeat((4 - (content.length % 4)) % 4);
  const base64 = (content + padding).replace(/-/g, '+').replace(/_/g, '/');

  const decodedData = atob(base64);
  return decodedData;
}
  
window.onload = function() {
  displaySavedCards();
  attachToggleListeners();

var toggleButtons = document.querySelectorAll('.toggleButton path');
toggleButtons.forEach(function(button) {
  button.style.fill = 'unset';
});
var toggleButtons1 = document.querySelectorAll('.toggleButtonSVG');
toggleButtons1.forEach(function(button1) {
  button1.style.fill = 'rgb(4 252 14 / 80%)';
});
};
</script>
{{ end }}
