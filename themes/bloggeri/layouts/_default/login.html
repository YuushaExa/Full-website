{{ define "main" }}
<section class="section">
  <article>      
    <div class="container">
      <div class="post">
        <h1 data-pagefind-ignore class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
  <div class="content">
    Register Account:
   <input type="text" id="Login" placeholder="Enter nickname" oninput="validateLogin(event)">
  <button id="createButton" onclick="Register()">Register</button>
  </br>
    Nickname:
    <input type="text" id="nickname" placeholder="Nickname" readonly="readonly"/>
 </br>
   Secret Key:
      <form><input type="password" id="secretKeyInput"></form>
      <button onclick="revealPassword()">Show Password</button>
 </br>
    Restore Account:
      <input type="text" id="RestoreID" placeholder="Enter Secret Key">
    <button onclick="Restore()">Restore Account</button>
    </div>    
<button id="deleteButton">Delete Account</button>

<script>
  document.getElementById('deleteButton').addEventListener('click', function() {
    var confirmation = confirm("Are you sure you want to delete the Account?");
    if (confirmation) {
      // User clicked "Yes"
      localStorage.removeItem('Account');
      localStorage.removeItem('SecretKeyID');
      document.getElementById('nickname').value = '';
      document.getElementById('Login').style.backgroundColor = 'white';
      document.getElementById('Login').readOnly = false;
      document.getElementById('createButton').style.backgroundColor = '#0d6efd';
      document.getElementById('createButton').style.cursor = 'pointer';
      document.getElementById('secretKeyInput').value = '';
	        document.getElementById('createButton').disabled = false;
    } else {
      // User clicked "No"
      // Handle the cancel action or do nothing
    }
  });

   function validateLogin(event) {
    const input = event.target;
    const value = input.value;
    const forbiddenChar = '#';

    if (value.includes(forbiddenChar)) {
      input.value = value.replace(forbiddenChar, '');
    }
  }

function Restore() {
  var gistURL = document.getElementById("RestoreID").value;
  var gistID = gistURL.split('/').pop();

  if (gistID) {
    var rawURL = `https://gist.githubusercontent.com/yuushaexa/${gistID}/raw`;

    fetch(rawURL)
      .then(response => {
        if (!response.ok) {
          throw new Error(`Gist request failed with status ${response.status}`);
        }
        return response.text();
      })
      .then(data => {
        var decompressedData = LZString.decompressFromEncodedURIComponent(data);
        var parsedData = JSON.parse(decompressedData);

        for (let key in parsedData) {
          if (parsedData.hasOwnProperty(key)) {
            localStorage.setItem(key, parsedData[key]);
          }
        }
        console.log("Gist data stored in local storage.");
        localStorage.setItem('SecretKeyID', gistID);
         document.getElementById('Login').style.backgroundColor = 'gray';
        document.getElementById('Login').readOnly = true;
        document.getElementById('createButton').disabled = true;
        document.getElementById('createButton').style.backgroundColor = 'gray';
        document.getElementById('createButton').style.cursor = 'not-allowed';
		document.getElementById('Login').value = '';
          const AccountValue = localStorage.getItem("Account");
      const LoginInput = document.getElementById("nickname");
    LoginInput.value = AccountValue;
              const secretKeyValue = localStorage.getItem("SecretKeyID");
      const secretKeyInput = document.getElementById("secretKeyInput");
    secretKeyInput.value = secretKeyValue;
        document.getElementById('RestoreID').style.backgroundColor = 'green';
        setTimeout(function() {
          document.getElementById('RestoreID').style.backgroundColor = 'white';
        }, 2000);
      })
      .catch(error => {
        console.error("Error fetching Gist:", error);
        document.getElementById('RestoreID').style.backgroundColor = 'red';
        console.log("Failed to fetch Gist data.");
        setTimeout(function() {
          document.getElementById('RestoreID').style.backgroundColor = 'white';
        }, 2000);
      });
  }
}

      const secretKeyValue = localStorage.getItem("SecretKeyID");
  
    // Set the retrieved value as the input's initial value
    const secretKeyInput = document.getElementById("secretKeyInput");
    secretKeyInput.value = secretKeyValue;

   function revealPassword() {
      const passwordInput = document.getElementById("secretKeyInput");

      if (passwordInput.type === "password") {
        passwordInput.type = "text";
      } else {
        passwordInput.type = "password";
      }
    }
</script>
      </div>  
       </div>  
  </article>    
</section>
<script src="https://log-4di.pages.dev/log.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

{{ end }}
