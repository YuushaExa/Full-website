{{ define "main" }}
<section class="section">
  <article data-pagefind-body>      
    <div class="container">
      <div class="post">
        <h1 data-pagefind-meta="title" class="post-title"><a href="{{ .Permalink }}">{{ .Title }}</a></h1>
    <div id="tags">
                           {{ partial "widgets/tags.html" . }}
                </div> 
    </div>
        <div class="cover-wrap">
        <div class="cover"></div></div>
  <div class="content">
          {{ .Content }} 
        </div>

<script>
  const apiKey = 'l9szo7ch2wkr9ijs0kqhau4ldiward';
const apiUrl = 'https://api.igdb.com/v4/games';
 
const perPage = 100;
 
async function fetchGames(page) {
  const requestData = {
    method: 'POST',
    headers: {
      'Client-ID': apiKey,
      'Content-Type': 'application/json',
    },
    body: `fields name, summary, release_dates; limit ${perPage}; offset ${perPage * (page - 1)};`,
  };
 
  const response = await fetch(apiUrl, requestData);
  return await response.json();
}
 
async function getAllGames() {
  try {
    let page = 1;
    let games = [];
    let hasMoreGames = true;
 
    while (hasMoreGames) {
      const data = await fetchGames(page);
      games = games.concat(data);
 
      if (data.length < perPage) {
        hasMoreGames = false;
      } else {
        page++;
      }
    }
 
    const jsonOutput = JSON.stringify(games, null, 2);
    const blob = new Blob([jsonOutput], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
 
    const link = document.createElement('a');
    link.href = url;
    link.download = 'games.json';
    link.click();
    URL.revokeObjectURL(url);
 
    console.log('Games saved as JSON successfully!');
  } catch (error) {
    console.error('Error saving games as JSON:', error);
  }
}
 
getAllGames();
  </script>
      
           <div class="cover-front">
                    <img src="https://wsrv.nl/?url={{ .Params.image }}&output=webp&maxage=1d&w=200&h=300&fit=cover&a=attention" alt="" crossorigin="anonymous">
       </div>
              <div class="game-links" data-pagefind-ignore>
                {{ partial "widgets/game-links.html" . }}
                </div> 
            <div class="ai" data-pagefind-ignore>
                {{ partialCached "widgets/ai.html" . }}
                </div> 
            <div id="GBinfo" data-pagefind-ignore class="tabcontent">
                {{ partial "widgets/gameinfo.html" . }}
                </div> 
         <div id="ReviewsReddit" data-pagefind-ignore>
                {{ partial "widgets/reviews.html" . }}
                </div> 
        <div class="gallery" data-pagefind-ignore>

{{ range .Params.images }}
<img data-src="https://wsrv.nl/?url={{ . }}&output=webp&maxage=1d&w=200" alt="" crossorigin="anonymous" class="lazyload" >
 {{ end }}          
                </div> 
        <div id="screenshots" data-pagefind-ignore>
                {{ partial "widgets/screenshots.html" . }}
                </div> 
    </div>      
  <div class="columns is-centered">
    <div class="column max-800px">
      <div class="columns is-mobile">
        <div class="column has-text-left">
          {{ with .PrevInSection }}
          <p>Previous post</p>
          <a href="{{ .Permalink }}">{{ .Title }}</a>
          {{ end }}
        </div>
        <div class="column has-text-right">
          {{ with .NextInSection }}
          <p>Next post</p>
          <a href="{{ .Permalink }}">{{ .Title }}</a>
        {{ end }}
        </div>
      </div>
    </div>
  </div>   

<section class="section">
    <div class="columns is-centered">
        <div class="column max-800px">
            <div class="content">
                <h2>Related content</h2>
            </div>
            <div class="columns">
{{ $related := .Site.RegularPages.Related . | first 3 }}
                {{ range $related }}
                <div class="column is-one-third">
                    {{ partial "widgets/post-card.html" . }}
                </div>
                {{ end }}
            </div>
        </div>
    </div>
</section>

 <script defer src="/js/posts.js"></script>
   <script defer src="/js/test.js"></script>
</section>
{{ end }}
